---
title: "Snow Course Data"
author: "AnnaClaire Marley"
date: "7/7/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

This Rmarkdown analyzes snow course data from the Navajo Nation. It:

* analyzes temporal variability of snowpack accumulation at each snow course site

* 

```{r, include = FALSE}
library(tidyverse)
library(lubridate)
library(janitor)
library(ggridges)
library(corrplot)
library(readxl)
library(gdata)
library(naniar)
```

```{r}
# set water year order
wint_wy_order <- c("Dec", "Jan", "Feb", "Mar", "Apr")
```


```{r, echo = FALSE}

# Turn snow course data into one dataframe 

  # get names of excel sheets
  list_sheets <- excel_sheets("../Data/NN_snowcoursedata_1985_2014.xlsx")
  
  # list of na strings that commonly occur in this dataset
  na_strings <- c("")
  
  snow_course = NULL # creat empty dataframe
  for (sheet_name in list_sheets) {
    
    print(sheet_name)
    # read individual excel sheets and clean
    readFile <- read.xls("../Data/NN_snowcoursedata_1985_2014.xlsx", 
                        sheet = sheet_name, header = TRUE, stringsAsFactors=FALSE)  %>% 
      select(1:13) %>% 
      replace_with_na_all(condition = ~. %in% na_strings) 
    
    if (is.null(snow_course)) { # don't merge the first one
      snow_course = readFile
    } else {
      snow_course = rbind(snow_course, readFile) # bind the files together
    }
  }
  
snow_course_clean <- snow_course %>% 
  clean_names() %>% 
  mutate(date_collected = ymd(date_collected)) %>% 
  select(station_name, "date" = date_collected, water_year, swe_m, ave_snow_depth_in) %>% 
  mutate(swe_m = as.numeric(swe_m)) %>% 
  mutate(av_snow_depth_m = conv_unit(ave_snow_depth_in, "inch", "m"))
  
```

Look at measurements

```{r, echo = FALSE}
ggplot(snow_course_clean, aes(x = date, y = swe_m)) +
  geom_point(aes(color = station_name))+
  geom_line(aes(color = station_name))+
  facet_wrap(~station_name)
```

Look at seasonal monthly median

```{r, echo = FALSE}

seasonal_median <- snow_course_clean %>% 
  mutate(month = month(date, label = TRUE, abbr = TRUE)) %>% 
  group_by(station_name, month) %>% 
  summarize(swe_m = median(swe_m, na.rm = TRUE)) %>% 
  drop_na()

ggplot(seasonal_median, aes(x = factor(month, wint_wy_order), y = swe_m, group = station_name)) +
  geom_point(aes(color = station_name)) +
  geom_line(aes(color = station_name)) +
  labs(
    x = "Month",
    y = "SWE (m)",
    color = "Station"
  ) +
  scale_y_continuous(expand = c(0,0)) +
  theme_classic()


```


Look at SWE distribution across the different stations
```{r, echo = FALSE}
# SWE
  ggplot(snow_course_clean, aes(x = swe_m, y = station_name)) +
  geom_density_ridges(scale = 7,
                      aes(fill = station_name),
                      size = 0.3,
                      color = "NA",
                      alpha = 0.5,
                      show.legend = FALSE) +
  theme_minimal() +
  labs(
    x = "SWE (mm)",
    y = "Snow Course Station"
  )

# Snow depth
ggplot(snow_course_clean, aes(x = av_snow_depth_m, y = station_name)) +
  geom_density_ridges(scale = 7,
                      aes(fill = station_name),
                      size = 0.3,
                      color = "NA",
                      alpha = 0.5,
                      show.legend = FALSE) +
  theme_minimal() +
  labs(
    x = "Snow Depth (m)",
    y = "Snow Course Station"
  )
```


